<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>并发控制概述 | Niko&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/icon.png">
    <meta name="description" content="自我驱动～">
    <link rel="preload" href="/assets/css/0.styles.e7705c3d.css" as="style"><link rel="preload" href="/assets/js/app.c4d916ef.js" as="script"><link rel="preload" href="/assets/js/2.7b65586e.js" as="script"><link rel="preload" href="/assets/js/17.e94f74a9.js" as="script"><link rel="prefetch" href="/assets/js/10.fe52b0c7.js"><link rel="prefetch" href="/assets/js/11.1ea010e8.js"><link rel="prefetch" href="/assets/js/12.4fad5f4d.js"><link rel="prefetch" href="/assets/js/13.b30c5e9b.js"><link rel="prefetch" href="/assets/js/14.3d89860c.js"><link rel="prefetch" href="/assets/js/15.1093c3a5.js"><link rel="prefetch" href="/assets/js/16.d78dfee6.js"><link rel="prefetch" href="/assets/js/18.04933970.js"><link rel="prefetch" href="/assets/js/19.2cfc6a06.js"><link rel="prefetch" href="/assets/js/20.5af1bca2.js"><link rel="prefetch" href="/assets/js/21.deead1cc.js"><link rel="prefetch" href="/assets/js/22.b167ef02.js"><link rel="prefetch" href="/assets/js/23.93287a34.js"><link rel="prefetch" href="/assets/js/24.2a666b39.js"><link rel="prefetch" href="/assets/js/25.079594fc.js"><link rel="prefetch" href="/assets/js/26.d3c406d8.js"><link rel="prefetch" href="/assets/js/27.0a55d4e3.js"><link rel="prefetch" href="/assets/js/28.4e1c4d5e.js"><link rel="prefetch" href="/assets/js/29.6ad66f6f.js"><link rel="prefetch" href="/assets/js/3.6982cefd.js"><link rel="prefetch" href="/assets/js/30.7f13756b.js"><link rel="prefetch" href="/assets/js/4.927b536d.js"><link rel="prefetch" href="/assets/js/5.b71571d4.js"><link rel="prefetch" href="/assets/js/6.61e89258.js"><link rel="prefetch" href="/assets/js/7.3c739ce6.js"><link rel="prefetch" href="/assets/js/8.89b308a0.js"><link rel="prefetch" href="/assets/js/9.e0fc39fd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e7705c3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Niko's blog</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/oldBlog/" class="nav-link router-link-active">
  Old blog
</a></div><div class="nav-item"><a href="https://github.com/Merlin-Liu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/oldBlog/" class="nav-link router-link-active">
  Old blog
</a></div><div class="nav-item"><a href="https://github.com/Merlin-Liu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/oldBlog/BSTmap.html" class="sidebar-link">二叉树的深度优先遍历和广度优先遍历</a></li><li><a href="/oldBlog/BST.html" class="sidebar-link">详细教你实现BST</a></li><li><a href="/oldBlog/functional.html" class="sidebar-link">函数式编程与React高阶组件</a></li><li><a href="/oldBlog/httpCache.html" class="sidebar-link">详解HTTP缓存</a></li><li><a href="/oldBlog/vuediff.html" class="sidebar-link">理解Vue 2.5的Diff算法</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>数据库事务处理的并发控制技术</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/oldBlog/concurrent.html" aria-current="page" class="active sidebar-link">并发控制概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/oldBlog/concurrent.html#_1-单用户数据库系统和多用户数据库系统" class="sidebar-link">1. 单用户数据库系统和多用户数据库系统</a></li><li class="sidebar-sub-header"><a href="/oldBlog/concurrent.html#_2-并发控制的必要性" class="sidebar-link">2. 并发控制的必要性</a></li></ul></li><li><a href="/oldBlog/transactionModel.html" class="sidebar-link">事务模型</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础业务</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/oldBlog/setState.html" class="sidebar-link">React的setState分析</a></li><li><a href="/oldBlog/virtualDOM.html" class="sidebar-link">Virtual DOM的简单实现</a></li><li><a href="/oldBlog/css.html" class="sidebar-link">多种方法实现左右固定，中间自适应的CSS布局</a></li><li><a href="/oldBlog/interview.html" class="sidebar-link">2017年10月WEB前端开发实习生面试题总结</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端实习生面试题分析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redux和React-Redux的实现</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>2018-01-23 08:53，发布于博客园</p> <p><a href="https://www.cnblogs.com/isLiu/p/8330922.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/isLiu/p/8330922.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p>事务是一些列的数据库操作，是数据库应用程序的基本逻辑单位。事务处理技术主要包括并发控制技术和数据库恢复技术。并发控制和数据库恢复机制是数据库管理系统的重要组成部分，并发控制机制用来控制多个事务的并行运行，避免它们之间的互相干扰，保证每个事务都产生正确的结果。数据库恢复机制用来进行系统失败后的恢复处理，确保数据库能够恢复到正确状态。</p> <h2 id="_1-单用户数据库系统和多用户数据库系统"><a href="#_1-单用户数据库系统和多用户数据库系统" class="header-anchor">#</a> 1. 单用户数据库系统和多用户数据库系统</h2> <hr> <p>数据库一般可以氛围单用户和多用户系统两种。在任何一个时刻只允许一个用户使用的数据库系统是单用户数据库系统。允许多个用户同时使用的数据库系统是多用户数据库系统。单用户数据库系统一般我们普通的计算机系统。大多数数据库系统都是多用户系统。就像火车票数据库系统、银行数据库系统。这样的系统中，同时并发运行的事务可能有几万个或者几十万个。</p> <p>多用户数据库系统的思想来自于并发程序设计。并发程序设计允许多个程序在一个计算机系统中同时运行。在具有单个处理机的系统中，程序的并发运行实际上是多个程序的轮流交叉运行，也就是我们常说的时间片轮转。在同一时刻，只有一个程序运行。当运行的程序需要等待某些信息或等待输入输出处理时，这个程序被挂起，其他可运行程序启动运行。当一个挂起的程序的等待信息到来或者等待的事件发生之后，如果处理机有空闲时间，这个程序从间断处恢复执行。虽然单处理机系统中的并行程序并没有被真正的并行运行，但是减少了处理机的空闲时间，提高了系统的效率。在多处理机系统中，每个处理机可以处理一个程序，多个处理机可以同时运行。在这样的系统中，我们可以实习多个程序的真正的并行运行。数据库系统的并发控制是以单处理机系统为基础的。所以我们以下就一单处理机系统为主。</p> <p>在一个多用户数据库系统中，数据库中存储的数据项是用户程序存取的基本信息资源。一个存取或改变数据库内容的程序成为一盒<strong>数据库事务</strong>，简称<strong>事务</strong>。多个事务可以同时运行并且可以同时存取或者修改同一个数据库记录。如果不对并发运行的事务加以控制，会引起很多问题。</p> <h2 id="_2-并发控制的必要性"><a href="#_2-并发控制的必要性" class="header-anchor">#</a> 2. 并发控制的必要性</h2> <hr> <p>我们使用火车票数据库系统来说明。假设在这个系统中，每个车次一个数据库记录。每个记录包括对应车次已经预定的座位数和一些其他的信息。设X和Y分别是车次K1和K2对应的数据库记录。</p> <p>下面的事务T1取消车次K1上已经预定的N个座位，并为车次K2增加N个预定座位。</p> <div class="language- extra-class"><pre class="language-text"><code>READ(X);
X = X - N;
WRTIE(X);
READ(Y);
Y = Y + N;
WRITE(Y)。
</code></pre></div><p>下面的事务T2为车次K1增加M个座位。</p> <div class="language- extra-class"><pre class="language-text"><code>READ(X);
X = X + M;
WRITE(X)。
</code></pre></div><p>现在我们来看看，不对T1和T2的并发运行加以控制将会出现什么问题。</p> <h3 id="_1-数据更新丢失的问题"><a href="#_1-数据更新丢失的问题" class="header-anchor">#</a> 1. 数据更新丢失的问题</h3> <p>设T1和T2差不多同时交付系统运行，而且T1和T2按下图的方式并发运行。T1和T2运行结束以后，X的值是不正确的，因为T2在T1完成对X的修改之前读X，丢失了T1对X的修改。假设T1和T2开始运行之前，X=60，N=5，M=6，X的最后结果应该是61，但是按下图的运行结果是66。</p> <p><img src="http://images2017.cnblogs.com/blog/1272362/201801/1272362-20180122195134944-1560164282.png" alt=""></p> <h3 id="_2-临时值问题"><a href="#_2-临时值问题" class="header-anchor">#</a> 2. 临时值问题</h3> <p>设T1和T2按下图的方式并发执行，T1在读Y时失败。这时系统必须把X恢复到原来的值，T1对X的影响被取消。可是，T2已经读取了由T1修改过的X的临时值，并使用这个不确定的值对X进行了修改。于是在下图中，T1和T2的运行结果是不正确的。我们把由T1修改过的X值叫临时值，因为他还没有被永久性的存储在数据库中。由下图这种并发运行方式所引起的问题叫临时值问题。</p> <p><img src="http://images2017.cnblogs.com/blog/1272362/201801/1272362-20180122200051412-2079294780.png" alt=""></p> <h3 id="_3-错误聚集计算问题"><a href="#_3-错误聚集计算问题" class="header-anchor">#</a> 3. 错误聚集计算问题</h3> <p>聚集计算函数经常在事务中出现，如求和函数。例如，如果两个事务并发运行，第一个事务计算数据库的所有记录的某个数据域的和，而第二个事务在更新这个数据域，那么第一个事务的计算结果可能处错。下图是个例子，当事务T3计算所有车次已经预定出得座位数的和时，事务T1更新相应的数据域。由于T3在X-N中后在读X，在Y+N之前读了Y，所以T3的计算结果比正确结果少N。</p> <p><img src="http://images2017.cnblogs.com/blog/1272362/201801/1272362-20180122201214928-1360359533.png" alt=""></p> <p>那我们该怎样对事务的并发进行控制呢？先让我们深入的了解下事务模型，下一节讲事务模型。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新于:</span> <span class="time">7/31/2020, 6:35:42 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c4d916ef.js" defer></script><script src="/assets/js/2.7b65586e.js" defer></script><script src="/assets/js/17.e94f74a9.js" defer></script>
  </body>
</html>
